# Supabase Setup Instructions for UrbanEye

## 1. Project Creation

1. Navigate to [supabase.com](https://supabase.com) and sign in to your account
2. Click "New Project"
3. Enter project details:
   - **Name**: `urbaneye`
   - **Database Password**: Choose a strong password
   - **Region**: Select the region closest to your users
4. Click "Create new project"
5. Wait for the project to be created (this may take a few minutes)

## 2. Get Project Credentials

1. Once the project is created, go to **Settings** → **API**
2. Copy the following values:

   - **Project URL** (e.g., `https://your-project-id.supabase.co`)
   - **anon public** key (starts with `eyJ...`)

3. Add these to your `frontend/env.example` file and rename it to `.env`

## 3. Database Schema Setup

1. In your Supabase dashboard, go to **SQL Editor**
2. Create a new query and run the following SQL:

```sql
-- Create the issues table to store all reports
CREATE TABLE public.issues (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL,
  issue_type TEXT NOT NULL,
  user_description TEXT NOT NULL,
  image_url TEXT NOT NULL,
  latitude DOUBLE PRECISION,
  longitude DOUBLE PRECISION,
  status TEXT DEFAULT 'reported' NOT NULL -- e.g., 'reported', 'in_progress', 'resolved'
);

-- Enable Row Level Security
ALTER TABLE public.issues ENABLE ROW LEVEL SECURITY;

-- Define RLS Policies for secure data access
-- Policy: Allow authenticated users to insert their own issues.
CREATE POLICY "Allow users to insert their own issues"
ON public.issues FOR INSERT
WITH CHECK (auth.uid() = user_id);

-- Policy: Allow all users to view all reported issues.
CREATE POLICY "Allow all users to view issues"
ON public.issues FOR SELECT
USING (true);

-- Policy: Allow users to update their own issues
CREATE POLICY "Allow users to update their own issues"
ON public.issues FOR UPDATE
USING (auth.uid() = user_id);

-- Policy: Allow users to delete their own issues
CREATE POLICY "Allow users to delete their own issues"
ON public.issues FOR DELETE
USING (auth.uid() = user_id);
```

## 4. Storage Setup

1. In your Supabase dashboard, go to **Storage**
2. Click "Create a new bucket"
3. Enter the following details:
   - **Name**: `issue_images`
   - **Public bucket**: ✅ Check this option
   - **File size limit**: `10 MB`
   - **Allowed MIME types**: `image/*`
4. Click "Create bucket"

## 5. Authentication Setup

1. Go to **Authentication** → **Settings**
2. Under **Site URL**, add your app's URL (for development, you can use `http://localhost:8081`)
3. Under **Redirect URLs**, add:
   - `http://localhost:8081`
   - `exp://localhost:8081`
   - Your production URL when ready

## 6. Row Level Security (RLS) Verification

1. Go to **Authentication** → **Policies**
2. Verify that the `issues` table has the correct policies applied
3. Ensure RLS is enabled on the `issues` table

## 7. Test the Setup

1. Go to **Authentication** → **Users**
2. Try creating a test user account
3. Use the **Table Editor** to verify the `issues` table structure
4. Test inserting a sample record

## 8. Environment Variables

Make sure your `.env` file contains:

```env
SUPABASE_URL="https://your-project-id.supabase.co"
SUPABASE_ANON_KEY="your-supabase-anon-key"
```

## 9. Troubleshooting

### Common Issues:

1. **RLS Policy Errors**: Make sure all policies are correctly applied
2. **Storage Permission Errors**: Verify the bucket is public and has correct policies
3. **Authentication Errors**: Check redirect URLs and site URL settings
4. **CORS Issues**: Ensure your app's domain is in the allowed origins

### Getting Help:

- Check the [Supabase Documentation](https://supabase.com/docs)
- Visit the [Supabase Community](https://github.com/supabase/supabase/discussions)
- Review the [React Native Guide](https://supabase.com/docs/guides/getting-started/tutorials/with-expo-react-native)

## 10. Production Considerations

1. **Custom Domain**: Set up a custom domain for your Supabase project
2. **Backup Strategy**: Enable automated backups
3. **Monitoring**: Set up alerts for database performance and errors
4. **Security**: Regularly review and update RLS policies
5. **Rate Limiting**: Consider implementing rate limiting for API calls
